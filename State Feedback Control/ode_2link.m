function dx = ode_2link(t,x)

m1=1; l1=1;l2=1; r1=0.45; r2=0.45; I1=0.084; I2=0.084; g=9.81;
m2=1;


dx = zeros(4,1);
x = num2cell(x);
[theta1, theta2, theta1_dot, theta2_dot] = deal(x{:});


K = [25.7954    8.2635    9.7870    3.6006;
     6.4934    6.0896    2.8937    1.4718];

u = -K*[theta1;theta2; theta1_dot; theta2_dot];
u1=u(1);
u2=u(2);


dx(1) = theta1_dot;
dx(2) = theta2_dot;
dx(3) = (I2*u1 - I2*u2 + m2*r2^2*u1*cos(theta1 + theta2)^2 - m2*r2^2*u2*cos(theta1 + theta2)^2 + m2*r2^2*u1*sin(theta1 + theta2)^2 - m2*r2^2*u2*sin(theta1 + theta2)^2 + I2*g*l1*m2*sin(theta1) + I2*g*m1*r1*sin(theta1) - l1*m2^2*r2^3*theta1_dot^2*cos(theta1 + theta2)^3*sin(theta1) + l1*m2^2*r2^3*theta1_dot^2*sin(theta1 + theta2)^3*cos(theta1) - l1*m2^2*r2^3*theta2_dot^2*cos(theta1 + theta2)^3*sin(theta1) + l1*m2^2*r2^3*theta2_dot^2*sin(theta1 + theta2)^3*cos(theta1) - l1*m2*r2*u2*cos(theta1 + theta2)*cos(theta1) - l1*m2*r2*u2*sin(theta1 + theta2)*sin(theta1) + g*l1*m2^2*r2^2*cos(theta1 + theta2)^2*sin(theta1) - g*l1*m2^2*r2^2*cos(theta1 + theta2)*sin(theta1 + theta2)*cos(theta1) + l1^2*m2^2*r2^2*theta1_dot^2*cos(theta1 + theta2)*sin(theta1 + theta2)*cos(theta1)^2 - 2*l1*m2^2*r2^3*theta1_dot*theta2_dot*cos(theta1 + theta2)^3*sin(theta1) + 2*l1*m2^2*r2^3*theta1_dot*theta2_dot*sin(theta1 + theta2)^3*cos(theta1) - l1^2*m2^2*r2^2*theta1_dot^2*cos(theta1 + theta2)*sin(theta1 + theta2)*sin(theta1)^2 - I2*l1*m2*r2*theta1_dot^2*cos(theta1 + theta2)*sin(theta1) + I2*l1*m2*r2*theta1_dot^2*sin(theta1 + theta2)*cos(theta1) - I2*l1*m2*r2*theta2_dot^2*cos(theta1 + theta2)*sin(theta1) + I2*l1*m2*r2*theta2_dot^2*sin(theta1 + theta2)*cos(theta1) - l1^2*m2^2*r2^2*theta1_dot^2*cos(theta1 + theta2)^2*cos(theta1)*sin(theta1) + l1^2*m2^2*r2^2*theta1_dot^2*sin(theta1 + theta2)^2*cos(theta1)*sin(theta1) + g*m1*m2*r1*r2^2*cos(theta1 + theta2)^2*sin(theta1) + l1*m2^2*r2^3*theta1_dot^2*cos(theta1 + theta2)^2*sin(theta1 + theta2)*cos(theta1) + l1*m2^2*r2^3*theta2_dot^2*cos(theta1 + theta2)^2*sin(theta1 + theta2)*cos(theta1) + g*m1*m2*r1*r2^2*sin(theta1 + theta2)^2*sin(theta1) - l1*m2^2*r2^3*theta1_dot^2*cos(theta1 + theta2)*sin(theta1 + theta2)^2*sin(theta1) - l1*m2^2*r2^3*theta2_dot^2*cos(theta1 + theta2)*sin(theta1 + theta2)^2*sin(theta1) - 2*l1*m2^2*r2^3*theta1_dot*theta2_dot*cos(theta1 + theta2)*sin(theta1 + theta2)^2*sin(theta1) - 2*I2*l1*m2*r2*theta1_dot*theta2_dot*cos(theta1 + theta2)*sin(theta1) + 2*I2*l1*m2*r2*theta1_dot*theta2_dot*sin(theta1 + theta2)*cos(theta1) + 2*l1*m2^2*r2^3*theta1_dot*theta2_dot*cos(theta1 + theta2)^2*sin(theta1 + theta2)*cos(theta1))/(I1*I2 + I1*m2*r2^2*sin(theta1 + theta2)^2 + I2*l1^2*m2*cos(theta1)^2 + I2*m1*r1^2*cos(theta1)^2 + I2*l1^2*m2*sin(theta1)^2 + I2*m1*r1^2*sin(theta1)^2 + I1*m2*r2^2*cos(theta1 + theta2)^2 + l1^2*m2^2*r2^2*cos(theta1 + theta2)^2*sin(theta1)^2 + l1^2*m2^2*r2^2*sin(theta1 + theta2)^2*cos(theta1)^2 + m1*m2*r1^2*r2^2*cos(theta1 + theta2)^2*cos(theta1)^2 + m1*m2*r1^2*r2^2*cos(theta1 + theta2)^2*sin(theta1)^2 + m1*m2*r1^2*r2^2*sin(theta1 + theta2)^2*cos(theta1)^2 + m1*m2*r1^2*r2^2*sin(theta1 + theta2)^2*sin(theta1)^2 - 2*l1^2*m2^2*r2^2*cos(theta1 + theta2)*sin(theta1 + theta2)*cos(theta1)*sin(theta1));
dx(4) = (I1*u2 - I2*u1 + I2*u2 - m2*r2^2*u1*cos(theta1 + theta2)^2 + m2*r2^2*u2*cos(theta1 + theta2)^2 - m2*r2^2*u1*sin(theta1 + theta2)^2 + m2*r2^2*u2*sin(theta1 + theta2)^2 + l1^2*m2*u2*cos(theta1)^2 + m1*r1^2*u2*cos(theta1)^2 + l1^2*m2*u2*sin(theta1)^2 + m1*r1^2*u2*sin(theta1)^2 + I1*g*m2*r2*sin(theta1 + theta2) - I2*g*l1*m2*sin(theta1) - I2*g*m1*r1*sin(theta1) + l1*m2^2*r2^3*theta1_dot^2*cos(theta1 + theta2)^3*sin(theta1) - l1*m2^2*r2^3*theta1_dot^2*sin(theta1 + theta2)^3*cos(theta1) + l1^3*m2^2*r2*theta1_dot^2*cos(theta1 + theta2)*sin(theta1)^3 - l1^3*m2^2*r2*theta1_dot^2*sin(theta1 + theta2)*cos(theta1)^3 + l1*m2^2*r2^3*theta2_dot^2*cos(theta1 + theta2)^3*sin(theta1) - l1*m2^2*r2^3*theta2_dot^2*sin(theta1 + theta2)^3*cos(theta1) - l1*m2*r2*u1*cos(theta1 + theta2)*cos(theta1) + 2*l1*m2*r2*u2*cos(theta1 + theta2)*cos(theta1) - l1*m2*r2*u1*sin(theta1 + theta2)*sin(theta1) + 2*l1*m2*r2*u2*sin(theta1 + theta2)*sin(theta1) - g*l1*m2^2*r2^2*cos(theta1 + theta2)^2*sin(theta1) + g*l1^2*m2^2*r2*sin(theta1 + theta2)*cos(theta1)^2 + l1^3*m2^2*r2*theta1_dot^2*cos(theta1 + theta2)*cos(theta1)^2*sin(theta1) + g*l1*m2^2*r2^2*cos(theta1 + theta2)*sin(theta1 + theta2)*cos(theta1) - l1^3*m2^2*r2*theta1_dot^2*sin(theta1 + theta2)*cos(theta1)*sin(theta1)^2 - 2*l1^2*m2^2*r2^2*theta1_dot^2*cos(theta1 + theta2)*sin(theta1 + theta2)*cos(theta1)^2 - l1^2*m2^2*r2^2*theta2_dot^2*cos(theta1 + theta2)*sin(theta1 + theta2)*cos(theta1)^2 - g*l1^2*m2^2*r2*cos(theta1 + theta2)*cos(theta1)*sin(theta1) + 2*l1*m2^2*r2^3*theta1_dot*theta2_dot*cos(theta1 + theta2)^3*sin(theta1) - 2*l1*m2^2*r2^3*theta1_dot*theta2_dot*sin(theta1 + theta2)^3*cos(theta1) + 2*l1^2*m2^2*r2^2*theta1_dot^2*cos(theta1 + theta2)*sin(theta1 + theta2)*sin(theta1)^2 + l1^2*m2^2*r2^2*theta2_dot^2*cos(theta1 + theta2)*sin(theta1 + theta2)*sin(theta1)^2 + I1*l1*m2*r2*theta1_dot^2*cos(theta1 + theta2)*sin(theta1) - I1*l1*m2*r2*theta1_dot^2*sin(theta1 + theta2)*cos(theta1) + I2*l1*m2*r2*theta1_dot^2*cos(theta1 + theta2)*sin(theta1) - I2*l1*m2*r2*theta1_dot^2*sin(theta1 + theta2)*cos(theta1) + I2*l1*m2*r2*theta2_dot^2*cos(theta1 + theta2)*sin(theta1) - I2*l1*m2*r2*theta2_dot^2*sin(theta1 + theta2)*cos(theta1) + 2*l1^2*m2^2*r2^2*theta1_dot^2*cos(theta1 + theta2)^2*cos(theta1)*sin(theta1) + l1^2*m2^2*r2^2*theta2_dot^2*cos(theta1 + theta2)^2*cos(theta1)*sin(theta1) - 2*l1^2*m2^2*r2^2*theta1_dot^2*sin(theta1 + theta2)^2*cos(theta1)*sin(theta1) - l1^2*m2^2*r2^2*theta2_dot^2*sin(theta1 + theta2)^2*cos(theta1)*sin(theta1) - g*m1*m2*r1*r2^2*cos(theta1 + theta2)^2*sin(theta1) + g*m1*m2*r1^2*r2*sin(theta1 + theta2)*cos(theta1)^2 - l1*m2^2*r2^3*theta1_dot^2*cos(theta1 + theta2)^2*sin(theta1 + theta2)*cos(theta1) - l1*m2^2*r2^3*theta2_dot^2*cos(theta1 + theta2)^2*sin(theta1 + theta2)*cos(theta1) - g*m1*m2*r1*r2^2*sin(theta1 + theta2)^2*sin(theta1) + g*m1*m2*r1^2*r2*sin(theta1 + theta2)*sin(theta1)^2 + l1*m2^2*r2^3*theta1_dot^2*cos(theta1 + theta2)*sin(theta1 + theta2)^2*sin(theta1) + l1*m2^2*r2^3*theta2_dot^2*cos(theta1 + theta2)*sin(theta1 + theta2)^2*sin(theta1) + 2*l1*m2^2*r2^3*theta1_dot*theta2_dot*cos(theta1 + theta2)*sin(theta1 + theta2)^2*sin(theta1) - 2*l1^2*m2^2*r2^2*theta1_dot*theta2_dot*cos(theta1 + theta2)*sin(theta1 + theta2)*cos(theta1)^2 + 2*l1^2*m2^2*r2^2*theta1_dot*theta2_dot*cos(theta1 + theta2)*sin(theta1 + theta2)*sin(theta1)^2 + 2*I2*l1*m2*r2*theta1_dot*theta2_dot*cos(theta1 + theta2)*sin(theta1) - 2*I2*l1*m2*r2*theta1_dot*theta2_dot*sin(theta1 + theta2)*cos(theta1) + 2*l1^2*m2^2*r2^2*theta1_dot*theta2_dot*cos(theta1 + theta2)^2*cos(theta1)*sin(theta1) - 2*l1^2*m2^2*r2^2*theta1_dot*theta2_dot*sin(theta1 + theta2)^2*cos(theta1)*sin(theta1) + l1*m1*m2*r1^2*r2*theta1_dot^2*cos(theta1 + theta2)*sin(theta1)^3 - l1*m1*m2*r1^2*r2*theta1_dot^2*sin(theta1 + theta2)*cos(theta1)^3 - 2*l1*m2^2*r2^3*theta1_dot*theta2_dot*cos(theta1 + theta2)^2*sin(theta1 + theta2)*cos(theta1) - g*l1*m1*m2*r1*r2*sin(theta1 + theta2)*sin(theta1)^2 - g*l1*m1*m2*r1*r2*cos(theta1 + theta2)*cos(theta1)*sin(theta1) + l1*m1*m2*r1^2*r2*theta1_dot^2*cos(theta1 + theta2)*cos(theta1)^2*sin(theta1) - l1*m1*m2*r1^2*r2*theta1_dot^2*sin(theta1 + theta2)*cos(theta1)*sin(theta1)^2)/(I1*I2 + I1*m2*r2^2*sin(theta1 + theta2)^2 + I2*l1^2*m2*cos(theta1)^2 + I2*m1*r1^2*cos(theta1)^2 + I2*l1^2*m2*sin(theta1)^2 + I2*m1*r1^2*sin(theta1)^2 + I1*m2*r2^2*cos(theta1 + theta2)^2 + l1^2*m2^2*r2^2*cos(theta1 + theta2)^2*sin(theta1)^2 + l1^2*m2^2*r2^2*sin(theta1 + theta2)^2*cos(theta1)^2 + m1*m2*r1^2*r2^2*cos(theta1 + theta2)^2*cos(theta1)^2 + m1*m2*r1^2*r2^2*cos(theta1 + theta2)^2*sin(theta1)^2 + m1*m2*r1^2*r2^2*sin(theta1 + theta2)^2*cos(theta1)^2 + m1*m2*r1^2*r2^2*sin(theta1 + theta2)^2*sin(theta1)^2 - 2*l1^2*m2^2*r2^2*cos(theta1 + theta2)*sin(theta1 + theta2)*cos(theta1)*sin(theta1));


end